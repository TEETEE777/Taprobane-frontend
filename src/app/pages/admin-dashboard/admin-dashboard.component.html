<app-admin-navbar></app-admin-navbar>

<div class="admin-dashboard">
  <h2 class="dashboard-title">üìä Admin Dashboard</h2>

  <!-- Stats Section -->
  <div class="stats">
    <div
      class="stat-card"
      *ngFor="
        let item of [
          { title: 'Total Users', value: stats.totalUsers, color: '#42a5f5' },
          { title: 'Sellers', value: stats.totalSellers, color: '#ff9800' },
          { title: 'Buyers', value: stats.totalBuyers, color: '#4caf50' },
          { title: 'Admins', value: stats.totalAdmins, color: '#9c27b0' },
          { title: 'Products', value: stats.totalProducts, color: '#009688' },
          { title: 'Orders', value: stats.totalOrders, color: '#f44336' }
        ]
      "
    >
      <h4>{{ item.title }}</h4>
      <p [style.color]="item.color">{{ item.value || 0 }}</p>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts">
    <!-- Pie Chart (Chart.js) -->
    <div class="chart-card">
      <h3>User Roles Distribution</h3>
      <div class="chart-wrapper" style="width: 300px; height: 300px">
        <canvas *ngIf="showPieCanvas" #pieCanvas></canvas>
      </div>
    </div>

    <!-- Bar Chart (ng2-charts) -->
    <div class="chart-card">
      <h3>Products vs Orders</h3>
      <div class="chart-wrapper">
        <canvas
          baseChart
          [data]="ordersProductsChartData"
          [options]="ordersProductsChartOptions"
          [type]="ordersProductsChartType"
        ></canvas>
      </div>
    </div>
  </div>

  <hr class="divider" />

  <!-- Users Table -->
  <h3 class="section-title">üë• User Management</h3>
  <div class="table-container" *ngIf="!loading; else loadingTpl">
    <table class="users-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th class="action-col">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users">
          <td>{{ user.fullName }}</td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-tag {{ user.role }}">{{ user.role }}</span>
          </td>
          <td>
            <span
              class="status-tag"
              [ngClass]="{ active: user.isActive, blocked: !user.isActive }"
            >
              {{ user.isActive ? "Active" : "Blocked" }}
            </span>
          </td>
          <td>
            <button
              class="action-btn"
              [ngClass]="user.isActive ? 'block' : 'unblock'"
              (click)="toggleUser(user._id, user.isActive)"
            >
              {{ user.isActive ? "Block" : "Unblock" }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #loadingTpl>
    <p class="loading">‚è≥ Loading users...</p>
  </ng-template>
</div>
